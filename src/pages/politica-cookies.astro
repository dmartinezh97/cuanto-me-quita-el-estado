---
import BaseLayout from '../layouts/BaseLayout.astro';
import Footer from '../components/astro/Footer.astro';
import CookieBanner from '../components/astro/CookieBanner.astro';
---

<BaseLayout
  title="Política de Cookies - Cuánto me quita el Estado"
  description="Información sobre las cookies utilizadas en cuantomequitaelestado.com"
>
  <div class="flex flex-col min-h-screen">
    <main class="flex-grow py-8 px-4 sm:px-6 lg:px-8">
      <article class="max-w-3xl mx-auto prose prose-stone dark:prose-invert">
        <a href="/" class="text-primary hover:underline text-sm no-underline">&larr; Volver a la calculadora</a>

        <h1 class="mt-6">Política de Cookies</h1>
        <p class="text-sm text-stone-500">Última actualización: Enero 2025</p>

        <h2>1. ¿Qué son las Cookies?</h2>
        <p>
          Las cookies son pequeños archivos de texto que los sitios web almacenan en tu dispositivo
          (ordenador, móvil, tablet) cuando los visitas. Sirven para recordar tus preferencias,
          mejorar tu experiencia de navegación y obtener información sobre cómo se utiliza el sitio.
        </p>

        <h2>2. Cookies que Utilizamos</h2>

        <h3>2.1 Cookies Técnicas (Necesarias)</h3>
        <p>
          Son esenciales para el funcionamiento del sitio. No requieren consentimiento.
        </p>
        <div class="overflow-x-auto">
          <table>
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Finalidad</th>
                <th>Duración</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>cookie_consent</code></td>
                <td>Guarda tu preferencia sobre cookies</td>
                <td>1 año</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3>2.2 Cookies de Análisis (Opcionales)</h3>
        <p>
          Nos ayudan a entender cómo los usuarios interactúan con el sitio.
          <strong>Solo se activan si das tu consentimiento.</strong>
        </p>
        <p>
          <em>Actualmente no tenemos cookies de análisis activas. Cuando las implementemos,
          actualizaremos esta sección.</em>
        </p>

        <h2>3. Tu Consentimiento</h2>
        <p>
          Al visitar nuestro sitio por primera vez, verás un banner que te permite:
        </p>
        <ul>
          <li><strong>Aceptar todas:</strong> Permites cookies técnicas y de análisis</li>
          <li><strong>Rechazar:</strong> Solo se usan cookies técnicas necesarias</li>
        </ul>

        <h2>4. Gestionar tus Preferencias</h2>
        <p>
          Puedes cambiar tu decisión sobre cookies en cualquier momento:
        </p>

        <div class="not-prose my-6 p-4 bg-stone-100 dark:bg-slate-800 rounded-lg">
          <p class="text-sm text-stone-600 dark:text-stone-400 mb-3">
            Tu preferencia actual: <strong id="current-consent" class="text-stone-900 dark:text-stone-100">Cargando...</strong>
          </p>
          <button
            id="reset-consent"
            class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-primary/90 rounded-lg transition-colors"
          >
            Cambiar preferencia de cookies
          </button>
        </div>

        <h2>5. Cómo Desactivar Cookies en tu Navegador</h2>
        <p>
          También puedes configurar tu navegador para bloquear o eliminar cookies:
        </p>
        <ul>
          <li><a href="https://support.google.com/chrome/answer/95647" target="_blank" rel="noopener">Google Chrome</a></li>
          <li><a href="https://support.mozilla.org/es/kb/Borrar%20cookies" target="_blank" rel="noopener">Mozilla Firefox</a></li>
          <li><a href="https://support.apple.com/es-es/guide/safari/sfri11471/mac" target="_blank" rel="noopener">Safari</a></li>
          <li><a href="https://support.microsoft.com/es-es/microsoft-edge/eliminar-cookies-en-microsoft-edge-63947406-40ac-c3b8-57b9-2a946a29ae09" target="_blank" rel="noopener">Microsoft Edge</a></li>
        </ul>
        <p>
          Ten en cuenta que desactivar las cookies puede afectar al funcionamiento de algunos sitios web.
        </p>

        <h2>6. Cookies de Terceros</h2>
        <p>
          Si en el futuro implementamos servicios de análisis (como Google Analytics o similares),
          estos proveedores podrían establecer sus propias cookies. Actualizaremos esta política
          con los detalles correspondientes y enlaces a sus políticas de privacidad.
        </p>

        <h2>7. Más Información</h2>
        <p>
          Para más información sobre cómo tratamos tus datos, consulta nuestra
          <a href="/politica-privacidad">Política de Privacidad</a>.
        </p>
        <p>
          Si tienes preguntas, contacta con nosotros en
          <a href="mailto:dmartinezh@protonmail.com">dmartinezh@protonmail.com</a>.
        </p>
      </article>
    </main>
    <Footer />
    <CookieBanner />
  </div>
</BaseLayout>

<style>
  .prose {
    --tw-prose-links: var(--color-primary);
  }
  .prose h1 {
    font-family: var(--font-display);
    font-size: 1.5rem;
  }
  .prose h2 {
    font-family: var(--font-display);
    font-size: 1.25rem;
    margin-top: 2rem;
  }
  .prose h3 {
    font-family: var(--font-display);
    font-size: 1.125rem;
    margin-top: 1.5rem;
  }
  .prose table {
    font-size: 0.875rem;
  }
  .prose code {
    font-size: 0.75rem;
    background-color: #e7e5e4;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
  }
  @media (min-width: 640px) {
    .prose h1 {
      font-size: 1.875rem;
    }
    .prose h2 {
      font-size: 1.5rem;
    }
  }
</style>

<script>
  function updateConsentDisplay(): void {
    const consentEl = document.getElementById('current-consent');
    if (!consentEl) return;

    const consent = localStorage.getItem('cookie_consent');

    if (consent === 'accepted') {
      consentEl.textContent = 'Cookies aceptadas';
    } else if (consent === 'rejected') {
      consentEl.textContent = 'Cookies rechazadas';
    } else {
      consentEl.textContent = 'Sin decidir';
    }
  }

  function initConsentManager(): void {
    updateConsentDisplay();

    const resetBtn = document.getElementById('reset-consent');
    resetBtn?.addEventListener('click', () => {
      if (typeof (window as any).resetCookieConsent === 'function') {
        (window as any).resetCookieConsent();
        updateConsentDisplay();
      }
    });

    // Update display when consent changes
    window.addEventListener('cookieConsentChanged', () => {
      updateConsentDisplay();
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initConsentManager);
  } else {
    initConsentManager();
  }
</script>
